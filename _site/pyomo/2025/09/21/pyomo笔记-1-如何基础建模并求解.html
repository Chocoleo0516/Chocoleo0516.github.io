<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Pyomo基础学习笔记【1】：如何基础建模并求解 | Chocoleo的博客</title>
  
  <link rel="stylesheet" href="/assets/css/style.css">
  <link rel="stylesheet" href="/assets/css/syntax.css">

  <script>
    window.MathJax = {
      tex: {
        inlineMath: [['$', '$'], ['\\(', '\\)']],
        displayMath: [['$$', '$$'], ['\\[', '\\]']]
      },
      svg: {
        fontCache: 'global'
      }
    };
  </script>
  <script type="text/javascript" id="MathJax-script" async
    src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js">
  </script>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC&display=swap" rel="stylesheet">

</head>
<body>
  <header>
    <div class="container">
      <h1><a href="/">Chocoleo的博客</a></h1>
      <nav>
      
        
        <a href="/">首页</a>
      
        
        <a href="/about.html">关于</a>
      
      </nav>
      <p>这里是我的个人博客，记录学习和思考的过程。</p>
    </div>
  </header>
  <main>
    <div class="container">
      <article>
  <h2>Pyomo基础学习笔记【1】：如何基础建模并求解</h2>
  <p class="post-meta">
    <time datetime="2025-09-21T21:08:47+08:00">2025年09月21日</time>
  </p>

  <div class="post-content">
    <h2 id="1pyomo-简介">1、Pyomo 简介</h2>

<p>Pyomo 是基于 Python 的开源软件包，主要功能是建立数学规划模型，包括线性规划，二次规划，整数规划，随机规划，含有微分代数方程的优化问题。Pyomo 只负责建模，求解需要调用求解器！</p>

<ol>
  <li>Pyomo 支持多种问题类型，包括：
    <ul>
      <li>线性规划</li>
      <li>二次规划</li>
      <li>非线性规划</li>
      <li>整数线性规划</li>
      <li>混合整数非线性规划</li>
      <li>混合整数二次规划</li>
      <li>微分代数方程</li>
      <li>整数随机规划</li>
      <li>广义析取规划</li>
      <li>带平衡约束的数学规划</li>
    </ul>
  </li>
  <li>采用 Pyomo 建模可以实现一次建模，通用求解。在 Pyomo 中建模后可以非常方便地调用其它多种求解器来求解，例如 Cplex，SCIP，Gurobi，Ipopt 等。</li>
</ol>

<h2 id="2pyomo-建模方法">2、Pyomo 建模方法</h2>

<p>可通过两种方式使用 Pyomo 创建优化模型：抽象（Abstract）和具体（Concrete）。这两种方式的关键区别在于是否将模型与数据分开引入：</p>

<p>在<strong>抽象模型</strong>中，模型与数据是分开的，支持在模型建立后再引入数据赋值。</p>

<p>在<strong>具体模型</strong>中，数据在模型本身中被定义。例如，在使用具体模型的 Pyomo 脚本中，所有内容都是在单个脚本文件中定义的。对于简单的问题，这可能是一种很高效的方法。但另一方面，对于规模比较大的问题（更大的数据集），这使得将数据和处理该数据所需的代码嵌入同一个 Python 脚本中变得不易实现且难以维护。</p>

<p>总体上讲，Pyomo 模型由<strong>变量（Variables）</strong>、<strong>参数（Parameters）</strong>、<strong>约束（Constraints）</strong>和<strong>目标（Objectives）</strong>组成。</p>

<!-- 
  * **变量（Variables）：**
    变量代表模型中待优化的决策变量，它是在优化求解中待计算的对象。求解优化模型后得到的变量的值通常称为解，它是优化求解过程的输出。
  * **参数（Parameters）：**
    参数通常指优化问题中提供的数据（系数），以便为决策变量找到最佳（或良好）的值分配。参数值也可以通过定义验证函数进行检查。
  * **约束（Constraints）：**
    约束是定义等式、不等式或其他数学表达式来指定变量的限制的一种方式。大多数约束是使用表达式规则创建的，这些规则往往是一个 Python 函数。
  * **优化目标（Objective）：**
    优化目标是指被建模系统的目标的函数，一般有最大化或最小化两种定义。 
-->

<h2 id="3基本案例">3、基本案例</h2>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="n">pyomo.environ</span> <span class="kn">import</span> <span class="o">*</span>
<span class="n">model</span> <span class="o">=</span> <span class="nc">ConcreteModel</span><span class="p">()</span>
<span class="n">model</span><span class="p">.</span><span class="n">x</span> <span class="o">=</span> <span class="nc">Var</span><span class="p">(</span><span class="nc">RangeSet</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="n">bounds</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">model</span><span class="p">.</span><span class="n">cons1</span> <span class="o">=</span> <span class="nc">Constraint</span><span class="p">(</span><span class="n">rule</span><span class="o">=</span><span class="k">lambda</span> <span class="n">model</span><span class="p">:</span> <span class="mi">40</span> <span class="o">==</span> <span class="n">model</span><span class="p">.</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">model</span><span class="p">.</span><span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">model</span><span class="p">.</span><span class="n">x</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">model</span><span class="p">.</span><span class="n">x</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
<span class="n">model</span><span class="p">.</span><span class="n">cons2</span> <span class="o">=</span> <span class="nc">Constraint</span><span class="p">(</span><span class="n">rule</span><span class="o">=</span><span class="k">lambda</span> <span class="n">model</span><span class="p">:</span> <span class="mi">25</span> <span class="o">&lt;=</span> <span class="n">model</span><span class="p">.</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">model</span><span class="p">.</span><span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">*</span><span class="n">model</span><span class="p">.</span><span class="n">x</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">*</span><span class="n">model</span><span class="p">.</span><span class="n">x</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span>
<span class="n">model</span><span class="p">.</span><span class="n">obj</span> <span class="o">=</span> <span class="nc">Objective</span><span class="p">(</span><span class="n">expr</span> <span class="o">=</span> <span class="n">model</span><span class="p">.</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">model</span><span class="p">.</span><span class="n">x</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="n">model</span><span class="p">.</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">model</span><span class="p">.</span><span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="n">model</span><span class="p">.</span><span class="n">x</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span> <span class="o">+</span> <span class="n">model</span><span class="p">.</span><span class="n">x</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">sense</span><span class="o">=</span><span class="n">minimize</span><span class="p">)</span>
<span class="nc">SolverFactory</span><span class="p">(</span><span class="sh">'</span><span class="s">ipopt</span><span class="sh">'</span><span class="p">).</span><span class="nf">solve</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
<span class="n">solutions</span> <span class="o">=</span> <span class="p">[</span><span class="n">model</span><span class="p">.</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">]()</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">)]</span>
<span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">solutins is :</span><span class="sh">"</span><span class="o">+</span><span class="nf">str</span><span class="p">(</span><span class="n">solutions</span><span class="p">))</span>
</code></pre></div></div>

<p>在这里我们只使用 <code class="language-plaintext highlighter-rouge">model = ConcreteModel()</code> 来定义模型，在 Pyomo 中还有另外一类抽象的 <code class="language-plaintext highlighter-rouge">AbstractModel()</code> 模型，相对来说该模型的使用更加高级。</p>

<h2 id="4建模六大要素">4、建模六大要素</h2>

<p>从运筹优化的理论来讲，一般优化模型的构成是三大要素：决策变量、约束，目标函数。但是在用代码实现优化模型的时候就不得不考虑另外三个不可或缺的要素：索引集合、参数和表达式。因此一共合成六大要素：</p>

<ol>
  <li>索引集合</li>
  <li>参数</li>
  <li>决策变量</li>
  <li>目标函数</li>
  <li>约束条件</li>
  <li>表达式</li>
</ol>

<p>在 Pyomo 中我们只要定义好了以上六大要素，也就基本完成了对优化问题的建模。下面以优化问题中常见的指派问题为例来说明这六大要素：</p>

<h3 id="41-索引集合">4.1 索引集合</h3>

<p>Pyomo 中常用的个集合类 <strong>Set</strong>和<strong>RangeSet</strong>：</p>

<h4 id="411-setinitialize-filter-validate关键字参数">4.1.1 <code class="language-plaintext highlighter-rouge">Set(initialize, filter, validate)</code>关键字参数：</h4>

<ul>
  <li><code class="language-plaintext highlighter-rouge">initialize</code>：表示初始化参数，可以采用列表，元组和集合来给一个 Set 初始化；</li>
  <li><code class="language-plaintext highlighter-rouge">filter</code>：表示一个过滤掉集合的条件，一般是一个函数表达式；</li>
  <li><code class="language-plaintext highlighter-rouge">validate</code>：表示对集合进行验证条件，一般是一个函数表达式；</li>
</ul>

<p>如下所示是采用多种方式来初始化集合的方法：</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="n">pyomo.environ</span> <span class="kn">import</span> <span class="o">*</span>
<span class="n">model</span> <span class="o">=</span> <span class="nc">ConcreteModel</span><span class="p">()</span>
<span class="n">model</span><span class="p">.</span><span class="n">I</span> <span class="o">=</span> <span class="nc">Set</span><span class="p">(</span><span class="n">initialize</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="mi">6</span><span class="p">)])</span> <span class="c1"># 采用列表初始化集合
</span><span class="n">model</span><span class="p">.</span><span class="n">J</span> <span class="o">=</span> <span class="nc">Set</span><span class="p">(</span><span class="n">initialize</span><span class="o">=</span><span class="p">(</span><span class="sh">'</span><span class="s">red</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">green</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">blue</span><span class="sh">'</span><span class="p">))</span> <span class="c1"># 采用元组初始化集合 并且用字符串作为元素引。
</span><span class="n">model</span><span class="p">.</span><span class="n">N</span> <span class="o">=</span> <span class="nc">Set</span><span class="p">([</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="mi">3</span><span class="p">)])</span> <span class="c1"># 等价于用 initialize
</span><span class="n">model</span><span class="p">.</span><span class="n">M</span> <span class="o">=</span> <span class="nc">Set</span><span class="p">([(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="mi">2</span><span class="p">)])</span>
<span class="k">def</span> <span class="nf">even_init</span><span class="p">(</span><span class="n">model</span><span class="p">):</span>
    <span class="nf">return </span><span class="p">(</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">model</span><span class="p">.</span><span class="n">I</span> <span class="k">if</span> <span class="n">i</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">model</span><span class="p">.</span><span class="n">K</span> <span class="o">=</span> <span class="nc">Set</span><span class="p">(</span><span class="n">initialize</span><span class="o">=</span><span class="n">even_init</span><span class="p">)</span> <span class="c1"># 可以通过一个函数even_init 来定义initialize，本例中就是选取偶数的索引。
</span></code></pre></div></div>

<p>采用 <code class="language-plaintext highlighter-rouge">filter</code> 参数可以对集合的元素进行筛选，如下例子中就是通过定义 <code class="language-plaintext highlighter-rouge">filter_rule</code> 来实现让 <code class="language-plaintext highlighter-rouge">model.P</code> 集合中只含有集合 <code class="language-plaintext highlighter-rouge">model.I</code> 没有的元素：</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">filter_rule</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">x</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">model</span><span class="p">.</span><span class="n">I</span>

<span class="n">model</span><span class="p">.</span><span class="n">P</span> <span class="o">=</span> <span class="nc">Set</span><span class="p">(</span><span class="n">initialize</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="mi">6</span><span class="p">)],</span> <span class="nb">filter</span> <span class="o">=</span> <span class="n">filter_rule</span><span class="p">)</span>
</code></pre></div></div>

<h4 id="412-rangesetstart-end-slice数字区间集合">4.1.2 <code class="language-plaintext highlighter-rouge">RangeSet(start, end, slice)</code>数字区间集合</h4>

<p>如果只需要纯数字作为索引的元素采用 <code class="language-plaintext highlighter-rouge">RangeSet</code> 会更加直接和方便一些，当然前面介绍的 <code class="language-plaintext highlighter-rouge">Set</code> 的功能可以覆盖掉 <code class="language-plaintext highlighter-rouge">RangeSet</code>。<code class="language-plaintext highlighter-rouge">RangeSet</code> 的用法如下所示：</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">model</span><span class="p">.</span><span class="n">D</span> <span class="o">=</span> <span class="nc">RangeSet</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="c1"># 表示 [1,3,5,7,9]
# model.D = RangeSet(10) # 表示默认从 1 到 10
# model.D = RangeSet(1,10) 表示 [1,2,3,4,5,6,7,8,9,10]
</span></code></pre></div></div>

<h4 id="413-集合的运算">4.1.3 集合的运算</h4>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">model</span><span class="p">.</span><span class="n">I</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="mi">5</span><span class="p">)]</span> <span class="c1"># 给集合赋值
</span><span class="nf">print</span><span class="p">([</span><span class="n">v</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">model</span><span class="p">.</span><span class="n">I</span><span class="p">])</span> <span class="c1"># 遍历集合中所有元素
</span><span class="nf">print</span><span class="p">(</span><span class="nf">len</span><span class="p">(</span><span class="n">model</span><span class="p">.</span><span class="n">J</span><span class="p">))</span> <span class="c1"># 3 表示集合元素个数
</span><span class="nf">print</span><span class="p">(</span><span class="n">model</span><span class="p">.</span><span class="n">I</span><span class="p">.</span><span class="nf">data</span><span class="p">())</span> <span class="c1"># (0, 1, 2, 3, 4) 表示 集合元素
</span><span class="nf">print</span><span class="p">(</span><span class="n">model</span><span class="p">.</span><span class="n">J</span><span class="p">.</span><span class="nf">data</span><span class="p">())</span> <span class="c1"># ('red', 'green', 'blue') 表示 集合元素
</span><span class="nf">print</span><span class="p">(</span><span class="mi">1</span> <span class="ow">in</span> <span class="n">model</span><span class="p">.</span><span class="n">I</span><span class="p">)</span> <span class="c1"># True 判断元素是否在集合内
</span><span class="nf">print</span><span class="p">(</span><span class="mi">12</span> <span class="ow">in</span> <span class="n">model</span><span class="p">.</span><span class="n">I</span><span class="p">)</span> <span class="c1"># False 判断元素是否在集合内
</span><span class="nf">print</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="n">model</span><span class="p">.</span><span class="n">I</span><span class="p">)</span> <span class="c1"># False 判断集合是否相等
</span><span class="nf">print</span><span class="p">([</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="mi">5</span><span class="p">)]</span> <span class="o">==</span> <span class="n">model</span><span class="p">.</span><span class="n">I</span><span class="p">)</span> <span class="c1"># True 判断集合是否相等
</span></code></pre></div></div>

<p>Pyomo 提供了几种集合之间的运算，这些运算与 Python 自带的集合类型十分相似。我这里列举在运筹优化中最常见的四种运算：并、交、差，笛卡尔积。</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">model</span><span class="p">.</span><span class="n">I</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="mi">6</span><span class="p">)]</span>
<span class="n">model</span><span class="p">.</span><span class="n">J</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span> <span class="k">if</span> <span class="n">i</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span>
<span class="n">model</span><span class="p">.</span><span class="n">K</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span>
<span class="n">model</span><span class="p">.</span><span class="n">E</span> <span class="o">=</span> <span class="n">model</span><span class="p">.</span><span class="n">I</span> <span class="o">&amp;</span> <span class="n">model</span><span class="p">.</span><span class="n">J</span> <span class="c1"># 交集 (0, 2, 4)
</span><span class="n">model</span><span class="p">.</span><span class="n">F</span> <span class="o">=</span> <span class="n">model</span><span class="p">.</span><span class="n">I</span> <span class="o">-</span> <span class="n">model</span><span class="p">.</span><span class="n">J</span> <span class="c1"># 差集 (1, 3, 5)
</span><span class="n">model</span><span class="p">.</span><span class="n">G</span> <span class="o">=</span> <span class="n">model</span><span class="p">.</span><span class="n">I</span> <span class="o">|</span> <span class="n">model</span><span class="p">.</span><span class="n">J</span> <span class="c1"># 并集 (0, 1, 2, 3, 4, 5)
</span><span class="n">model</span><span class="p">.</span><span class="n">H</span> <span class="o">=</span> <span class="n">model</span><span class="p">.</span><span class="n">J</span> <span class="o">*</span> <span class="n">model</span><span class="p">.</span><span class="n">K</span> <span class="c1"># 笛卡尔积 ((0, 1), (0, 2), (2, 1), (2, 2), (4, 1), (4, 2))
</span></code></pre></div></div>

<h3 id="42-参数">4.2 参数</h3>
<p>核心类：pyomo.core.base.param.Param，来定义模型中的已知常量（输入数据），比如成本、需求量、容量等。可以是标量，也可以带索引。</p>

<p><code class="language-plaintext highlighter-rouge">Param(initialize, default, validate, within, doc)</code>关键字参数：</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">initialize</code>：表示初始化参数，可以采用列表，元组和字典来做参数初始化；</li>
  <li><code class="language-plaintext highlighter-rouge">default</code>：表示初始化参数的默认值，<code class="language-plaintext highlighter-rouge">initialize</code> 没有覆盖的索引 <code class="language-plaintext highlighter-rouge">default</code> 才会起作用；</li>
  <li><code class="language-plaintext highlighter-rouge">validate</code>：表示对集合进行验证条件，一般是一个函数表达式</li>
  <li><code class="language-plaintext highlighter-rouge">within</code>：指定参数所属集合（定义域），保证取值合法</li>
  <li><code class="language-plaintext highlighter-rouge">doc</code>：文档说明，方便阅读，Param(doc=”产能上限”)</li>
</ul>

<h4 id="421-简单赋值法初始化参数">4.2.1 简单赋值法初始化参数</h4>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="n">pyomo.environ</span> <span class="kn">import</span> <span class="o">*</span>
<span class="n">model</span> <span class="o">=</span> <span class="nc">ConcreteModel</span><span class="p">()</span>
<span class="n">model</span><span class="p">.</span><span class="n">I</span> <span class="o">=</span> <span class="nc">Set</span><span class="p">(</span><span class="n">initialize</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="mi">4</span><span class="p">)])</span>
<span class="n">model</span><span class="p">.</span><span class="n">J</span> <span class="o">=</span> <span class="nc">Set</span><span class="p">(</span><span class="n">initialize</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="mi">4</span><span class="p">)])</span>
<span class="n">model</span><span class="p">.</span><span class="n">c</span> <span class="o">=</span> <span class="nc">Param</span><span class="p">(</span><span class="n">model</span><span class="p">.</span><span class="n">I</span><span class="p">,</span> <span class="n">model</span><span class="p">.</span><span class="n">J</span><span class="p">,</span> <span class="n">default</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span> <span class="c1"># 参数 c 是一个 4×4 的矩阵 并且初始值全部为 1
</span></code></pre></div></div>

<h4 id="422-字典初始化参数">4.2.2 字典初始化参数</h4>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">c_data</span> <span class="o">=</span> <span class="p">{(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">):</span> <span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">):</span> <span class="mi">33</span><span class="p">,</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">):</span> <span class="mi">20</span><span class="p">}</span> <span class="c1"># 采用字典初始化 表示 c[0,0]=1, c[1,2]=33, c[3,3]=20
</span><span class="n">model</span><span class="p">.</span><span class="n">c1</span> <span class="o">=</span> <span class="nc">Param</span><span class="p">(</span><span class="n">model</span><span class="p">.</span><span class="n">I</span><span class="p">,</span> <span class="n">model</span><span class="p">.</span><span class="n">J</span><span class="p">,</span> <span class="n">initialize</span><span class="o">=</span><span class="n">c_data</span><span class="p">,</span> <span class="n">default</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span> <span class="c1"># default = 0 表示其余元素都为 0
</span></code></pre></div></div>

<h4 id="423-函数初始化参数">4.2.3 函数初始化参数</h4>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">c_init</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="n">j</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">i</span> <span class="o">*</span> <span class="n">i</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="mf">0.0</span>

<span class="n">model</span><span class="p">.</span><span class="n">c2</span> <span class="o">=</span> <span class="nc">Param</span><span class="p">(</span><span class="n">model</span><span class="p">.</span><span class="n">I</span><span class="p">,</span> <span class="n">model</span><span class="p">.</span><span class="n">J</span><span class="p">,</span> <span class="n">initialize</span><span class="o">=</span><span class="n">c_init</span><span class="p">)</span>
</code></pre></div></div>

<h4 id="424-validate-验证参数取值正确性">4.2.4 <code class="language-plaintext highlighter-rouge">validate</code> 验证参数取值正确性</h4>

<p>借用 <code class="language-plaintext highlighter-rouge">c_validate</code> 函数可以方便验证参数选取是否满足一些硬性条件，如果不满足条件则会直接报错提示我们。这是一个非常好的预防 bug 提升代码鲁棒性的功能，同时 <code class="language-plaintext highlighter-rouge">validate</code> 并不影响我们对数学模型的实现。</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">c_data</span> <span class="o">=</span> <span class="p">{(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">):</span> <span class="mi">4</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">):</span> <span class="mi">33</span><span class="p">,</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">):</span> <span class="mi">20</span><span class="p">}</span>
<span class="k">def</span> <span class="nf">c_validate</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">):</span> <span class="c1"># 保证所有 c_{ij} 的值都要大于 3
</span>    <span class="k">return</span> <span class="n">v</span> <span class="o">&gt;</span> <span class="mf">3.</span>

<span class="n">model</span><span class="p">.</span><span class="n">c3</span> <span class="o">=</span> <span class="nc">Param</span><span class="p">(</span><span class="n">model</span><span class="p">.</span><span class="n">I</span><span class="p">,</span> <span class="n">model</span><span class="p">.</span><span class="n">J</span><span class="p">,</span> <span class="n">initialize</span><span class="o">=</span><span class="n">c_data</span><span class="p">,</span> <span class="n">validate</span><span class="o">=</span><span class="n">c_validate</span><span class="p">)</span>
</code></pre></div></div>

<h4 id="425-参数常用操作">4.2.5 参数常用操作</h4>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">print</span><span class="p">(</span><span class="nf">len</span><span class="p">(</span><span class="n">model</span><span class="p">.</span><span class="n">c</span><span class="p">))</span> <span class="c1"># 9 参数元素个数
</span><span class="nf">print</span><span class="p">(</span><span class="mi">1</span> <span class="ow">in</span> <span class="n">model</span><span class="p">.</span><span class="n">c</span><span class="p">)</span> <span class="c1"># False
</span><span class="nf">print</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span> <span class="ow">in</span> <span class="n">model</span><span class="p">.</span><span class="n">c</span><span class="p">)</span> <span class="c1"># True
</span><span class="nf">print</span><span class="p">([</span><span class="n">v</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">model</span><span class="p">.</span><span class="n">c</span><span class="p">])</span> <span class="c1"># [(0, 0), (0, 1), (0, 2), (1, 0), (1, 1), (1, 2), (2, 0), (2...
</span></code></pre></div></div>

<h3 id="43-决策变量">4.3 决策变量</h3>
<p>在 Pyomo 中，决策变量统一由<strong>Var类</strong>定义。Var 既可以是标量变量（单个变量），也可以是索引变量（多维数组形式的变量）。
<code class="language-plaintext highlighter-rouge">Var(index_set, domain(或within), bounds, initialize, defaultl, doc)</code>关键字参数：</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">index_set</code>：表示决策变量的索引；</li>
  <li><code class="language-plaintext highlighter-rouge">bounds</code>：表示决策变量上下界；</li>
  <li><code class="language-plaintext highlighter-rouge">domain(或within)</code> ：表示决策变量的定义域；</li>
  <li><code class="language-plaintext highlighter-rouge">initialize</code> ：表示决策变量的初值；</li>
  <li><code class="language-plaintext highlighter-rouge">default</code>：默认值（如果没有初始化）</li>
</ul>

<h4 id="431-一维决策变量定义">4.3.1 一维决策变量定义</h4>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="n">pyomo.environ</span> <span class="kn">import</span> <span class="o">*</span>
<span class="n">model</span> <span class="o">=</span> <span class="nc">ConcreteModel</span><span class="p">()</span>
<span class="c1"># Reals 表示实数变量，上下界为 0-6，初始值设为 1.5
</span><span class="n">model</span><span class="p">.</span><span class="n">x</span> <span class="o">=</span> <span class="nc">Var</span><span class="p">(</span><span class="n">within</span><span class="o">=</span><span class="n">Reals</span><span class="p">,</span> <span class="n">bounds</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">6</span><span class="p">),</span> <span class="n">initialize</span><span class="o">=</span><span class="mf">1.5</span><span class="p">)</span>
</code></pre></div></div>

<h4 id="432-多维决策变量定义">4.3.2 多维决策变量定义</h4>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">fb</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">):</span>
    <span class="nf">return </span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="c1"># 下界为 0，上界为 1
</span>
<span class="n">model</span><span class="p">.</span><span class="n">I</span> <span class="o">=</span> <span class="nc">Set</span><span class="p">(</span><span class="n">initialize</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="mi">4</span><span class="p">)])</span>
<span class="n">model</span><span class="p">.</span><span class="n">J</span> <span class="o">=</span> <span class="nc">Set</span><span class="p">(</span><span class="n">initialize</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="mi">4</span><span class="p">)])</span>
<span class="n">model</span><span class="p">.</span><span class="n">y</span> <span class="o">=</span> <span class="nc">Var</span><span class="p">(</span><span class="n">model</span><span class="p">.</span><span class="n">I</span><span class="p">,</span> <span class="n">model</span><span class="p">.</span><span class="n">J</span><span class="p">,</span> <span class="n">within</span><span class="o">=</span><span class="n">PositiveIntegers</span><span class="p">,</span> <span class="n">bounds</span><span class="o">=</span><span class="n">fb</span><span class="p">)</span>
<span class="c1"># 表示决策变量 y 维数为 4×4，正整数变量，上下通过函数 fb() 定义
</span>
<span class="k">def</span> <span class="nf">fb1</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">):</span>
    <span class="nf">return </span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span> <span class="c1"># None 表示没有上界
</span>
<span class="n">model</span><span class="p">.</span><span class="n">z</span> <span class="o">=</span> <span class="nc">Var</span><span class="p">(</span><span class="n">model</span><span class="p">.</span><span class="n">I</span><span class="p">,</span> <span class="n">model</span><span class="p">.</span><span class="n">J</span><span class="p">,</span> <span class="n">within</span><span class="o">=</span><span class="n">PositiveIntegers</span><span class="p">,</span> <span class="n">bounds</span><span class="o">=</span><span class="n">fb1</span><span class="p">)</span>
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">within</code> 可以选择的类型有：</p>

<ul>
  <li>Reals: 实数</li>
  <li>PositiveReals：正实数</li>
  <li>NonPositiveReals: 非正实数</li>
  <li>NegativeReals: 负实数</li>
  <li>NonNegativeReals：非负实数</li>
  <li>PercentFraction: 0 到 1 之间实数</li>
  <li>UnitInterval: 同 PercentFraction</li>
  <li>Integers: 整数</li>
  <li>PositiveIntegers: 正整数</li>
  <li>NonPositiveIntegers: 非正整数</li>
  <li>NegativeIntegers: 负整数</li>
  <li>Boolean: 布尔变量</li>
  <li>Binary: 0,1变量</li>
</ul>

<h4 id="433-给决策变量赋初值">4.3.3 给决策变量赋初值</h4>

<p>这是一个很重要的功能，因为很多算法都涉及到 warm start 的问题，给决策变量赋一个好的初值会加速整个求解过程。在 pyomo 中就是通过 <code class="language-plaintext highlighter-rouge">initialize</code> 参数来实现给决策变量赋初值的功能，相关代码如下所示：</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">model</span><span class="p">.</span><span class="n">x_init1</span> <span class="o">=</span> <span class="nc">Var</span><span class="p">(</span><span class="n">model</span><span class="p">.</span><span class="n">I</span><span class="p">,</span> <span class="n">model</span><span class="p">.</span><span class="n">J</span><span class="p">,</span> <span class="n">initialize</span> <span class="o">=</span> <span class="p">{(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">):</span><span class="mf">1.2</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">):</span><span class="mi">30</span><span class="p">,</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">):</span> <span class="mi">21</span><span class="p">})</span> <span class="c1"># 字典赋初值给决策变量
</span><span class="n">model</span><span class="p">.</span><span class="n">x_init2</span> <span class="o">=</span> <span class="nc">Var</span><span class="p">(</span><span class="n">model</span><span class="p">.</span><span class="n">I</span><span class="p">,</span> <span class="n">model</span><span class="p">.</span><span class="n">J</span><span class="p">,</span> <span class="n">initialize</span> <span class="o">=</span> <span class="mf">2.0</span><span class="p">)</span> <span class="c1"># 初值全为 2.0
</span><span class="k">def</span> <span class="nf">g_init</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">i</span> <span class="o">+</span> <span class="n">j</span>
<span class="n">model</span><span class="p">.</span><span class="n">x_init3</span> <span class="o">=</span> <span class="nc">Var</span><span class="p">(</span><span class="n">model</span><span class="p">.</span><span class="n">I</span><span class="p">,</span> <span class="n">model</span><span class="p">.</span><span class="n">J</span><span class="p">,</span> <span class="n">initialize</span> <span class="o">=</span> <span class="n">g_init</span><span class="p">)</span> <span class="c1"># 通过函数 g_init 给定初值
</span><span class="nf">print</span><span class="p">(</span><span class="nf">value</span><span class="p">(</span><span class="n">model</span><span class="p">.</span><span class="n">x_init1</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]))</span> <span class="c1"># 1.2
</span><span class="nf">print</span><span class="p">(</span><span class="nf">value</span><span class="p">(</span><span class="n">model</span><span class="p">.</span><span class="n">x_init1</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">]))</span> <span class="c1"># 30
</span><span class="nf">print</span><span class="p">(</span><span class="nf">value</span><span class="p">(</span><span class="n">model</span><span class="p">.</span><span class="n">x_init2</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]))</span> <span class="c1"># 2.0
</span><span class="nf">print</span><span class="p">(</span><span class="nf">value</span><span class="p">(</span><span class="n">model</span><span class="p">.</span><span class="n">x_init2</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">]))</span> <span class="c1"># 2.0
</span><span class="nf">print</span><span class="p">(</span><span class="nf">value</span><span class="p">(</span><span class="n">model</span><span class="p">.</span><span class="n">x_init3</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">]))</span> <span class="c1"># 6.0
</span></code></pre></div></div>

<h4 id="434-决策变量的固定">4.3.4 决策变量的固定</h4>

<p>在优化算法中我们为了降低问题的规模，经常会采用固定住一部分决策变量，只优化另外一部分决策变量的策略。这种直观的方法也被称为 fixed and relaxed。在 Pyomo 中也给我们提供了这样固定住决策变量的方法，一旦变量被固定住之后，在优化求解过程中该变量均被视为常数不会被改变，代码如下所示：</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">model</span><span class="p">.</span><span class="n">x_init1</span><span class="p">.</span><span class="nf">fix</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="c1"># 表示把 x_init1 决策变量固定为 1
</span><span class="nf">print</span><span class="p">(</span><span class="n">model</span><span class="p">.</span><span class="n">x_init1</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">].</span><span class="n">fixed</span><span class="p">)</span> <span class="c1"># True 表示该变量是固定变量
</span><span class="nf">print</span><span class="p">(</span><span class="nf">value</span><span class="p">(</span><span class="n">model</span><span class="p">.</span><span class="n">x_init1</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]))</span> <span class="c1"># 1
</span></code></pre></div></div>

<h3 id="44-目标函数">4.4 目标函数</h3>
<p>核心类：pyomo.core.base.objective.Objective，用于定义优化模型的目标函数
<code class="language-plaintext highlighter-rouge">Objective(expr, rule, sense，doc)</code>关键字参数：</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">expr</code>：表达式（数学公式），通常由变量和参数构造</li>
  <li><code class="language-plaintext highlighter-rouge">rule</code>：表示目标函数定义规则，返回表达式（适合批量或复杂目标函数）</li>
  <li><code class="language-plaintext highlighter-rouge">sense</code>：<code class="language-plaintext highlighter-rouge">maximize</code> 代表是极大化问题，<code class="language-plaintext highlighter-rouge">minimize</code> 代表极小化问题；</li>
</ul>

<h4 id="441-简单表达式定义目标函数直接定义expr">4.4.1 简单表达式定义目标函数，直接定义（expr）</h4>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">model</span> <span class="o">=</span> <span class="nc">ConcreteModel</span><span class="p">()</span>
<span class="n">model</span><span class="p">.</span><span class="n">I</span> <span class="o">=</span> <span class="nc">Set</span><span class="p">(</span><span class="n">initialize</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="mi">2</span><span class="p">)])</span>
<span class="n">model</span><span class="p">.</span><span class="n">J</span> <span class="o">=</span> <span class="nc">Set</span><span class="p">(</span><span class="n">initialize</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="mi">3</span><span class="p">)])</span>
<span class="n">model</span><span class="p">.</span><span class="n">x</span> <span class="o">=</span> <span class="nc">Var</span><span class="p">(</span><span class="n">model</span><span class="p">.</span><span class="n">I</span><span class="p">,</span> <span class="n">model</span><span class="p">.</span><span class="n">J</span><span class="p">,</span> <span class="n">domain</span> <span class="o">=</span> <span class="n">Reals</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">obj_rule</span><span class="p">(</span><span class="n">model</span><span class="p">):</span>
    <span class="k">return</span> <span class="mi">2</span><span class="o">*</span><span class="n">model</span><span class="p">.</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">3</span><span class="o">*</span><span class="n">model</span><span class="p">.</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span>

<span class="n">model</span><span class="p">.</span><span class="n">obj1</span> <span class="o">=</span> <span class="nc">Objective</span><span class="p">(</span><span class="n">rule</span> <span class="o">=</span> <span class="n">obj_rule</span><span class="p">,</span> <span class="n">sense</span> <span class="o">=</span> <span class="n">minimize</span><span class="p">)</span>
</code></pre></div></div>

<h4 id="442-用函数规则rule借助各种复杂表达式定义目标函数">4.4.2 用函数规则（rule）借助各种复杂表达式定义目标函数</h4>

<p>Pyomo 中可以建模各种各样的目标函数，如下的目标函数中包括了三角函数，多项式函数，指数函数和对数函数。</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">obj_rule</span><span class="p">(</span><span class="n">model</span><span class="p">):</span>
    <span class="n">expr</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">model</span><span class="p">.</span><span class="n">I</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">model</span><span class="p">.</span><span class="n">J</span><span class="p">:</span>
            <span class="n">expr</span> <span class="o">+=</span> <span class="nf">sin</span><span class="p">(</span><span class="n">model</span><span class="p">.</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">])</span> <span class="o">+</span> <span class="n">model</span><span class="p">.</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="mi">2</span><span class="o">**</span><span class="p">(</span><span class="n">model</span><span class="p">.</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">])</span> <span class="o">+</span> <span class="nf">log</span><span class="p">(</span><span class="n">model</span><span class="p">.</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">expr</span>

<span class="n">model</span><span class="p">.</span><span class="n">obj3</span> <span class="o">=</span> <span class="nc">Objective</span><span class="p">(</span><span class="n">rule</span> <span class="o">=</span> <span class="n">obj_rule</span><span class="p">,</span> <span class="n">sense</span> <span class="o">=</span> <span class="n">minimize</span><span class="p">)</span>
</code></pre></div></div>

<h4 id="443-借助-summation-函数定义目标函数">4.4.3 借助 <code class="language-plaintext highlighter-rouge">summation</code> 函数定义目标函数</h4>

<p><code class="language-plaintext highlighter-rouge">summation</code> 函数是 Pyomo 中可以实现两个向量快速求内积的操作，如下代码是实现目标函数：</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">model</span><span class="p">.</span><span class="n">p</span> <span class="o">=</span> <span class="nc">Param</span><span class="p">(</span><span class="n">model</span><span class="p">.</span><span class="n">I</span><span class="p">,</span> <span class="n">model</span><span class="p">.</span><span class="n">J</span><span class="p">,</span> <span class="n">default</span> <span class="o">=</span> <span class="mi">2</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">obj_rule</span><span class="p">(</span><span class="n">model</span><span class="p">):</span>
    <span class="k">return</span> <span class="nf">summation</span><span class="p">(</span><span class="n">model</span><span class="p">.</span><span class="n">p</span><span class="p">,</span> <span class="n">model</span><span class="p">.</span><span class="n">x</span><span class="p">)</span>
<span class="n">model</span><span class="p">.</span><span class="n">obj2</span> <span class="o">=</span> <span class="nc">Objective</span><span class="p">(</span><span class="n">rule</span> <span class="o">=</span> <span class="n">obj_rule</span><span class="p">,</span> <span class="n">sense</span> <span class="o">=</span> <span class="n">maximize</span><span class="p">)</span>
</code></pre></div></div>

<h4 id="444-带有索引的目标函数定义">4.4.4 带有索引的目标函数定义</h4>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">e_rule</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">model</span><span class="p">.</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span>
<span class="n">model</span><span class="p">.</span><span class="n">e1</span> <span class="o">=</span> <span class="nc">Objective</span><span class="p">(</span><span class="n">model</span><span class="p">.</span><span class="n">I</span><span class="p">,</span> <span class="n">model</span><span class="p">.</span><span class="n">J</span><span class="p">,</span> <span class="n">rule</span><span class="o">=</span><span class="n">e_rule</span><span class="p">)</span>
</code></pre></div></div>

<h4 id="445-借助-skip-实现目标函数灵活定义">4.4.5 借助 Skip 实现目标函数灵活定义</h4>

<p>某些索引需要跳过的，可以采用 <code class="language-plaintext highlighter-rouge">Objective.Skip</code>，如下所示就是跳过 <code class="language-plaintext highlighter-rouge">i == j</code> 的情况，就可以在对变矩阵选择性的执行函数：</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">e_rule</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="n">j</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">Objective</span><span class="p">.</span><span class="n">Skip</span>
    <span class="k">return</span> <span class="n">model</span><span class="p">.</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span>

<span class="n">model</span><span class="p">.</span><span class="n">e2</span> <span class="o">=</span> <span class="nc">Objective</span><span class="p">(</span><span class="n">model</span><span class="p">.</span><span class="n">I</span><span class="p">,</span> <span class="n">model</span><span class="p">.</span><span class="n">J</span><span class="p">,</span> <span class="n">rule</span><span class="o">=</span><span class="n">e_rule</span><span class="p">)</span>
</code></pre></div></div>

<h4 id="446-访问目标函数的性质">4.4.6 访问目标函数的性质</h4>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">print</span><span class="p">(</span><span class="n">model</span><span class="p">.</span><span class="n">obj1</span><span class="p">.</span><span class="n">expr</span><span class="p">)</span> <span class="c1"># 2*x[1,1] + 3*x[2,2] 返回目标函数的表达式
</span><span class="nf">print</span><span class="p">(</span><span class="n">model</span><span class="p">.</span><span class="n">obj1</span><span class="p">.</span><span class="n">sense</span><span class="p">)</span> <span class="c1"># -1 表示极大化 1 表示极小化
</span><span class="nf">print</span><span class="p">(</span><span class="nf">value</span><span class="p">(</span><span class="n">model</span><span class="p">.</span><span class="n">obj1</span><span class="p">))</span> <span class="c1"># 返回目标函数值
</span></code></pre></div></div>

<h3 id="45-约束">4.5 约束</h3>
<p>在 Pyomo 里，所有约束由<strong>Constraint类</strong>定义。
<code class="language-plaintext highlighter-rouge">Constraint(index_set, expr, rule)</code>关键字参数：</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">index_set</code>：表示约束索引集合；</li>
  <li><code class="language-plaintext highlighter-rouge">rule</code>：表示约束定义规则；</li>
  <li><code class="language-plaintext highlighter-rouge">expr</code>：表示约束表达式；</li>
</ul>

<h4 id="451-借助表达式定义单条约束">4.5.1 借助表达式定义单条约束</h4>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">model</span> <span class="o">=</span> <span class="nc">ConcreteModel</span><span class="p">()</span>
<span class="n">model</span><span class="p">.</span><span class="n">I</span> <span class="o">=</span> <span class="nc">Set</span><span class="p">(</span><span class="n">initialize</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="mi">3</span><span class="p">)])</span>
<span class="n">model</span><span class="p">.</span><span class="n">J</span> <span class="o">=</span> <span class="nc">Set</span><span class="p">(</span><span class="n">initialize</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="mi">3</span><span class="p">)])</span>
<span class="n">model</span><span class="p">.</span><span class="n">x</span> <span class="o">=</span> <span class="nc">Var</span><span class="p">(</span><span class="n">model</span><span class="p">.</span><span class="n">I</span><span class="p">,</span> <span class="n">model</span><span class="p">.</span><span class="n">J</span><span class="p">,</span> <span class="n">initialize</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span> <span class="n">within</span> <span class="o">=</span> <span class="n">Reals</span><span class="p">)</span>
<span class="n">model</span><span class="p">.</span><span class="n">c1</span> <span class="o">=</span> <span class="nc">Constraint</span><span class="p">(</span><span class="n">expr</span> <span class="o">=</span> <span class="mf">2.0</span> <span class="o">&lt;=</span> <span class="n">model</span><span class="p">.</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">model</span><span class="p">.</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">])</span> <span class="c1"># 不等式约束 2 &lt;= x[0,0] + 2*x[0,2]
</span><span class="n">model</span><span class="p">.</span><span class="n">c2</span> <span class="o">=</span> <span class="nc">Constraint</span><span class="p">(</span><span class="n">expr</span> <span class="o">=</span> <span class="mi">3</span><span class="o">*</span><span class="n">model</span><span class="p">.</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">5</span><span class="o">*</span><span class="n">model</span><span class="p">.</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mf">10.0</span><span class="p">)</span> <span class="c1"># 等式约束 3*x[0,0] + 5*x[1,1] = 10.0
</span><span class="nf">print</span><span class="p">(</span><span class="nf">value</span><span class="p">(</span><span class="n">model</span><span class="p">.</span><span class="n">c1</span><span class="p">.</span><span class="n">body</span><span class="p">))</span> <span class="c1"># 3 返回 c1 表达式的值
</span><span class="nf">print</span><span class="p">(</span><span class="n">model</span><span class="p">.</span><span class="n">c1</span><span class="p">.</span><span class="nf">lslack</span><span class="p">())</span> <span class="c1"># 1.0 返回 c1 约束和下限的差(lower bound slack variable)
</span><span class="nf">print</span><span class="p">(</span><span class="n">model</span><span class="p">.</span><span class="n">c1</span><span class="p">.</span><span class="nf">uslack</span><span class="p">())</span> <span class="c1"># +inf 返回 c1 约束和上限的差(upper bound slack variable)
</span><span class="nf">print</span><span class="p">(</span><span class="n">model</span><span class="p">.</span><span class="n">c2</span><span class="p">.</span><span class="nf">lslack</span><span class="p">())</span> <span class="c1"># -2.0 返回 c2 约束和下限的差(lower bound slack variable)
</span><span class="nf">print</span><span class="p">(</span><span class="n">model</span><span class="p">.</span><span class="n">c2</span><span class="p">.</span><span class="nf">uslack</span><span class="p">())</span> <span class="c1"># 2.0 返回 c2 约束和上限的差(upper bound slack variable)
</span></code></pre></div></div>

<p><strong>注意：</strong>约束与下限差的计算是约束减下限，相反约束与上限的差是上限减约束。</p>

<h4 id="452-借用函数定义单个约束">4.5.2 借用函数定义单个约束</h4>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">model</span><span class="p">.</span><span class="n">p</span> <span class="o">=</span> <span class="nc">Param</span><span class="p">(</span><span class="n">model</span><span class="p">.</span><span class="n">I</span><span class="p">,</span> <span class="n">model</span><span class="p">.</span><span class="n">J</span><span class="p">,</span> <span class="n">default</span> <span class="o">=</span> <span class="mi">2</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">c3_rule</span><span class="p">(</span><span class="n">model</span><span class="p">):</span>
    <span class="k">return</span> <span class="nf">summation</span><span class="p">(</span><span class="n">model</span><span class="p">.</span><span class="n">p</span><span class="p">,</span> <span class="n">model</span><span class="p">.</span><span class="n">x</span><span class="p">)</span> <span class="o">+</span> <span class="n">model</span><span class="p">.</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span> <span class="o">&lt;=</span> <span class="mi">2</span>

<span class="n">model</span><span class="p">.</span><span class="n">c3</span> <span class="o">=</span> <span class="nc">Constraint</span><span class="p">(</span><span class="n">rule</span> <span class="o">=</span> <span class="n">c3_rule</span><span class="p">)</span>
</code></pre></div></div>

<h4 id="453-索引约束借用函数定义多条约束">4.5.3 索引约束：借用函数定义多条约束</h4>

<p>定义一组约束，每个索引对应一个约束。</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">model</span><span class="p">.</span><span class="n">I</span> <span class="o">=</span> <span class="nc">RangeSet</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">con_rule</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">i</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">m</span><span class="p">.</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">m</span><span class="p">.</span><span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mi">10</span>
<span class="n">model</span><span class="p">.</span><span class="n">con</span> <span class="o">=</span> <span class="nc">Constraint</span><span class="p">(</span><span class="n">model</span><span class="p">.</span><span class="n">I</span><span class="p">,</span> <span class="n">rule</span><span class="o">=</span><span class="n">con_rule</span><span class="p">)</span>
</code></pre></div></div>

<p>如果需要跳过某些不需要定义约束的索引下标，同理也可以采用 <code class="language-plaintext highlighter-rouge">Constraint.Skip</code> 就可以跳过相对应的下标。如下所示就是跳过了 <code class="language-plaintext highlighter-rouge">i=0</code> 的情况：</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">c4_rule</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">i</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">Constraint</span><span class="p">.</span><span class="n">Skip</span>
    <span class="k">return</span> <span class="nf">sum</span><span class="p">([</span><span class="n">model</span><span class="p">.</span><span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span><span class="o">*</span><span class="n">model</span><span class="p">.</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">model</span><span class="p">.</span><span class="n">J</span><span class="p">])</span> <span class="o">&lt;=</span> <span class="mi">2</span>

<span class="n">model</span><span class="p">.</span><span class="n">c4</span> <span class="o">=</span> <span class="nc">Constraint</span><span class="p">(</span><span class="n">model</span><span class="p">.</span><span class="n">I</span><span class="p">,</span> <span class="n">rule</span> <span class="o">=</span> <span class="n">c4_rule</span><span class="p">)</span>
</code></pre></div></div>

<h4 id="454-激活约束和停用约束">4.5.4 激活约束和停用约束</h4>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">model</span><span class="p">.</span><span class="n">c2</span><span class="p">.</span><span class="nf">deactivate</span><span class="p">()</span> <span class="c1"># c2 约束失效
</span><span class="n">model</span><span class="p">.</span><span class="n">c2</span><span class="p">.</span><span class="nf">activate</span><span class="p">()</span>   <span class="c1"># 重新激活 c2 约束
</span></code></pre></div></div>

<h3 id="46-表达式">4.6 表达式</h3>
<p>核心类：
	•	pyomo.core.base.expression.Expression
	•	可以是 标量表达式 (ScalarExpression)
	•	也可以是 索引表达式 (IndexedExpression)
<code class="language-plaintext highlighter-rouge">Expression(expr, rule, doc)</code>关键字参数：</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">expr</code>：表达式；</li>
  <li><code class="language-plaintext highlighter-rouge">rule</code>：定义表达式的函数；</li>
</ul>

<h4 id="461-定义单个表达式标量表达式">4.6.1 定义单个表达式（标量表达式）</h4>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="n">pyomo.environ</span> <span class="kn">import</span> <span class="o">*</span>
<span class="n">model</span> <span class="o">=</span> <span class="nc">ConcreteModel</span><span class="p">()</span>
<span class="n">model</span><span class="p">.</span><span class="n">I</span> <span class="o">=</span> <span class="nc">Set</span><span class="p">(</span><span class="n">initialize</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="mi">3</span><span class="p">)])</span>
<span class="n">model</span><span class="p">.</span><span class="n">x</span> <span class="o">=</span> <span class="nc">Var</span><span class="p">(</span><span class="n">model</span><span class="p">.</span><span class="n">I</span><span class="p">,</span> <span class="n">within</span> <span class="o">=</span> <span class="n">Reals</span><span class="p">,</span> <span class="n">initialize</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">)</span>
<span class="n">model</span><span class="p">.</span><span class="n">e</span> <span class="o">=</span> <span class="nc">Expression</span><span class="p">(</span><span class="n">expr</span> <span class="o">=</span> <span class="n">model</span><span class="p">.</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">3</span><span class="o">*</span><span class="n">model</span><span class="p">.</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="c1"># 建立表达式 e = x[0] + 3*x[1]
</span><span class="nf">print</span><span class="p">(</span><span class="nf">value</span><span class="p">(</span><span class="n">model</span><span class="p">.</span><span class="n">e</span><span class="p">))</span> <span class="c1"># 4.0
</span><span class="n">model</span><span class="p">.</span><span class="n">e</span><span class="p">.</span><span class="nf">set_value</span><span class="p">(</span><span class="n">model</span><span class="p">.</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="c1"># 重新给表达式赋值 e = x[1]
</span><span class="nf">print</span><span class="p">(</span><span class="nf">value</span><span class="p">(</span><span class="n">model</span><span class="p">.</span><span class="n">e</span><span class="p">))</span> <span class="c1"># 1.0
</span></code></pre></div></div>

<h4 id="462-定义多个表达式索引表达式">4.6.2 定义多个表达式（索引表达式）</h4>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">expr_rule</span><span class="p">(</span><span class="n">model</span><span class="p">,</span><span class="n">i</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">Expression</span><span class="p">.</span><span class="n">Skip</span>
    <span class="k">return</span> <span class="n">model</span><span class="p">.</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">i</span>

<span class="n">model</span><span class="p">.</span><span class="n">e1</span> <span class="o">=</span> <span class="nc">Expression</span><span class="p">(</span><span class="n">model</span><span class="p">.</span><span class="n">I</span><span class="p">,</span> <span class="n">rule</span> <span class="o">=</span> <span class="n">expr_rule</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">gen_expr_rule</span><span class="p">(</span><span class="n">model</span><span class="p">,</span><span class="n">i</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">model</span><span class="p">.</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">model</span><span class="p">.</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="nf">exp</span><span class="p">(</span><span class="n">model</span><span class="p">.</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>

<span class="n">model</span><span class="p">.</span><span class="n">e2</span> <span class="o">=</span> <span class="nc">Expression</span><span class="p">(</span><span class="n">model</span><span class="p">.</span><span class="n">I</span><span class="p">,</span> <span class="n">rule</span> <span class="o">=</span> <span class="n">gen_expr_rule</span><span class="p">)</span>
</code></pre></div></div>

<h4 id="463-采用单表达式辅助定义约束和目标函数">4.6.3 采用单表达式辅助定义约束和目标函数</h4>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">model</span><span class="p">.</span><span class="n">obj</span> <span class="o">=</span> <span class="nc">Objective</span><span class="p">(</span><span class="n">expr</span> <span class="o">=</span> <span class="mf">0.1</span> <span class="o">*</span> <span class="n">model</span><span class="p">.</span><span class="n">e</span> <span class="o">+</span> <span class="n">model</span><span class="p">.</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">model</span><span class="p">.</span><span class="n">constr</span> <span class="o">=</span> <span class="nc">Constraint</span><span class="p">(</span><span class="n">expr</span> <span class="o">=</span> <span class="n">model</span><span class="p">.</span><span class="n">e</span> <span class="o">&lt;=</span> <span class="mf">1.0</span><span class="p">)</span>
</code></pre></div></div>

<h4 id="464-采用多表达式辅助定义约束和目标函数">4.6.4 采用多表达式辅助定义约束和目标函数</h4>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">constrs1_rule</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">i</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">model</span><span class="p">.</span><span class="n">e2</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">model</span><span class="p">.</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mi">2</span>

<span class="n">model</span><span class="p">.</span><span class="n">constrs1</span> <span class="o">=</span> <span class="nc">Constraint</span><span class="p">(</span><span class="n">model</span><span class="p">.</span><span class="n">I</span><span class="p">,</span> <span class="n">rule</span> <span class="o">=</span> <span class="n">constrs1_rule</span><span class="p">)</span> <span class="c1"># model.I 约束索引集合
</span></code></pre></div></div>

<h2 id="5求解">5、求解</h2>

<p>前面讲过 Pyomo 只能完成建模的任务，求解的还是需要将 Pyomo 的模型导入到专业的优化求解器来实现。如下代码就是调用 Gurobi 求解其来实现求解：</p>

<h3 id="51-调用求解器">5.1 调用求解器</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">model</span> <span class="o">=</span> <span class="nc">ConcreteModel</span><span class="p">()</span>
<span class="n">model</span><span class="p">.</span><span class="n">I</span> <span class="o">=</span> <span class="nc">Set</span><span class="p">(</span><span class="n">initialize</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="mi">4</span><span class="p">)])</span>
<span class="n">model</span><span class="p">.</span><span class="n">J</span> <span class="o">=</span> <span class="nc">Set</span><span class="p">(</span><span class="n">initialize</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="mi">4</span><span class="p">)])</span>
<span class="n">model</span><span class="p">.</span><span class="n">x</span> <span class="o">=</span> <span class="nc">Var</span><span class="p">(</span><span class="n">model</span><span class="p">.</span><span class="n">I</span><span class="p">,</span> <span class="n">model</span><span class="p">.</span><span class="n">J</span><span class="p">,</span> <span class="n">within</span> <span class="o">=</span> <span class="n">Reals</span><span class="p">,</span> <span class="n">bounds</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
<span class="n">model</span><span class="p">.</span><span class="n">c</span> <span class="o">=</span> <span class="nc">Param</span><span class="p">(</span><span class="n">model</span><span class="p">.</span><span class="n">I</span><span class="p">,</span> <span class="n">model</span><span class="p">.</span><span class="n">J</span><span class="p">,</span> <span class="n">initialize</span> <span class="o">=</span> <span class="p">{(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">):</span><span class="mi">2</span><span class="p">,</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">):</span><span class="mi">3</span><span class="p">},</span> <span class="n">default</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">obj_rule</span><span class="p">(</span><span class="n">model</span><span class="p">):</span>
    <span class="k">return</span> <span class="nf">summation</span><span class="p">(</span><span class="n">model</span><span class="p">.</span><span class="n">c</span><span class="p">,</span> <span class="n">model</span><span class="p">.</span><span class="n">x</span><span class="p">)</span> <span class="c1"># 定义目标函数
</span>
<span class="k">def</span> <span class="nf">constrs_rule1</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">i</span><span class="p">):</span>
    <span class="k">return</span> <span class="nf">sum</span><span class="p">([</span><span class="n">model</span><span class="p">.</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">model</span><span class="p">.</span><span class="n">J</span><span class="p">])</span> <span class="o">==</span> <span class="mi">1</span> <span class="c1"># 定义约束 5.3
</span>
<span class="k">def</span> <span class="nf">constrs_rule2</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">j</span><span class="p">):</span>
    <span class="k">return</span> <span class="nf">sum</span><span class="p">([</span><span class="n">model</span><span class="p">.</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">model</span><span class="p">.</span><span class="n">I</span><span class="p">])</span> <span class="o">==</span> <span class="mi">1</span> <span class="c1"># 定义约束 5.2
</span>
<span class="n">model</span><span class="p">.</span><span class="n">obj</span> <span class="o">=</span> <span class="nc">Objective</span><span class="p">(</span><span class="n">rule</span> <span class="o">=</span> <span class="n">obj_rule</span><span class="p">,</span> <span class="n">sense</span> <span class="o">=</span> <span class="n">minimize</span><span class="p">)</span> <span class="c1"># 设置优化目标，最小化目标函数
</span><span class="n">model</span><span class="p">.</span><span class="n">constrs1</span> <span class="o">=</span> <span class="nc">Constraint</span><span class="p">(</span><span class="n">model</span><span class="p">.</span><span class="n">I</span><span class="p">,</span> <span class="n">rule</span> <span class="o">=</span> <span class="n">constrs_rule1</span><span class="p">)</span>
<span class="n">model</span><span class="p">.</span><span class="n">constrs2</span> <span class="o">=</span> <span class="nc">Constraint</span><span class="p">(</span><span class="n">model</span><span class="p">.</span><span class="n">J</span><span class="p">,</span> <span class="n">rule</span> <span class="o">=</span> <span class="n">constrs_rule2</span><span class="p">)</span>
<span class="n">model</span><span class="p">.</span><span class="n">dual</span> <span class="o">=</span> <span class="nc">Suffix</span><span class="p">(</span><span class="n">direction</span><span class="o">=</span><span class="n">Suffix</span><span class="p">.</span><span class="n">IMPORT</span><span class="p">)</span> <span class="c1"># 对偶变量定义
</span><span class="n">opt</span> <span class="o">=</span> <span class="nc">SolverFactory</span><span class="p">(</span><span class="sh">'</span><span class="s">gurobi</span><span class="sh">'</span><span class="p">)</span> <span class="c1"># 指定 gurobi 作为求解器
# opt = SolverFactory('cplex') # 指定 cplex 作为求解器
# opt = SolverFactory('scip') # 指定 scip 作为求解器
</span><span class="n">solution</span> <span class="o">=</span> <span class="n">opt</span><span class="p">.</span><span class="nf">solve</span><span class="p">(</span><span class="n">model</span><span class="p">)</span> <span class="c1"># 调用求解器求解
</span></code></pre></div></div>

<h3 id="52-优化结果导出">5.2 优化结果导出</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">solution</span><span class="p">.</span><span class="nf">write</span><span class="p">()</span> <span class="c1"># 写入求解结果
</span><span class="n">x_opt</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">array</span><span class="p">([</span><span class="nf">value</span><span class="p">(</span><span class="n">model</span><span class="p">.</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">model</span><span class="p">.</span><span class="n">I</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">model</span><span class="p">.</span><span class="n">J</span><span class="p">]).</span><span class="nf">reshape</span><span class="p">((</span><span class="nf">len</span><span class="p">(</span><span class="n">model</span><span class="p">.</span><span class="n">I</span><span class="p">),</span> <span class="nf">len</span><span class="p">(</span><span class="n">model</span><span class="p">.</span><span class="n">J</span><span class="p">)))</span> <span class="c1"># 提取最优解
</span><span class="n">obj_values</span> <span class="o">=</span> <span class="nf">value</span><span class="p">(</span><span class="n">model</span><span class="p">.</span><span class="n">obj</span><span class="p">)</span> <span class="c1"># 提取目标函数
</span><span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">optimum point: </span><span class="se">\n</span><span class="s"> {} </span><span class="sh">"</span><span class="p">.</span><span class="nf">format</span><span class="p">(</span><span class="n">x_opt</span><span class="p">))</span>
<span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">optimal objective: {}</span><span class="sh">"</span><span class="p">.</span><span class="nf">format</span><span class="p">(</span><span class="n">obj_values</span><span class="p">))</span>
</code></pre></div></div>

<h3 id="53-对偶变量值导出">5.3 对偶变量值导出</h3>

<p>记得如果需要使用对偶变量的话，需要在求解之前定义好对偶变量，例如 <code class="language-plaintext highlighter-rouge">model.dual = Suffix(direction=Suffix.IMPORT)</code>，这样才能在求解完毕之后采用下面的例子来遍历所需要的对偶变量的值：</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">model</span><span class="p">.</span><span class="n">constrs1</span><span class="p">:</span>
    <span class="nf">print</span><span class="p">(</span><span class="n">model</span><span class="p">.</span><span class="n">dual</span><span class="p">[</span><span class="n">model</span><span class="p">.</span><span class="n">constrs1</span><span class="p">[</span><span class="n">c</span><span class="p">]])</span> <span class="c1"># 遍历约束 constrs1 的对偶变量
</span></code></pre></div></div>

<h3 id="54-求解状态查看">5.4 求解状态查看</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">print</span><span class="p">(</span><span class="n">solution</span><span class="p">.</span><span class="n">solver</span><span class="p">.</span><span class="n">termination_condition</span><span class="p">)</span> <span class="c1"># 终止条件 一般包括三种 optimal, feasible, infeasible
</span><span class="nf">print</span><span class="p">(</span><span class="n">solution</span><span class="p">.</span><span class="n">solver</span><span class="p">.</span><span class="n">termination_message</span><span class="p">)</span> <span class="c1"># 求解得到的信息 一般为一行字符串信息
</span><span class="nf">print</span><span class="p">(</span><span class="n">solution</span><span class="p">.</span><span class="n">solver</span><span class="p">.</span><span class="n">status</span><span class="p">)</span> <span class="c1"># 表示求解的状态 包括 ok, warning, error, aborted, or unknown
</span></code></pre></div></div>

<h2 id="6常见求解器">6、常见求解器</h2>

<table>
  <thead>
    <tr>
      <th>求解器</th>
      <th>类型支持</th>
      <th>特点与说明</th>
      <th>授权方式</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>GLPK</td>
      <td>线性规划 (LP)、整数线性规划 (MILP)</td>
      <td>轻量级、免费、开源，适合中小规模问题</td>
      <td>GPL 开源</td>
    </tr>
    <tr>
      <td>CBC</td>
      <td>LP、MILP</td>
      <td>COIN-OR 项目，适合中等规模 MILP，免费开源</td>
      <td>EPL 开源</td>
    </tr>
    <tr>
      <td>SCIP</td>
      <td>LP、MILP、MINLP</td>
      <td>在混合整数非线性规划方面强大，学术免费（非商业需授权）</td>
      <td>学术免费</td>
    </tr>
    <tr>
      <td>CPLEX</td>
      <td>LP、MILP、QP、MIQP、MINLP</td>
      <td>商业级高性能求解器，广泛用于工业界</td>
      <td>IBM 商业许可</td>
    </tr>
    <tr>
      <td>Gurobi</td>
      <td>LP、MILP、QP、MIQP、SOCP</td>
      <td>工业界性能最强之一，支持 Python 接口，速度快、功能全</td>
      <td>商业许可（学术免费）</td>
    </tr>
    <tr>
      <td>Mosek</td>
      <td>LP、QP、SOCP、CONE</td>
      <td>擅长锥优化问题（SOCP、SDP 等），数值稳定性好</td>
      <td>商业许可</td>
    </tr>
    <tr>
      <td>Ipopt</td>
      <td>NLP、MINLP</td>
      <td>适合大规模非线性问题，开源，常与 Couenne 结合</td>
      <td>EPL 开源</td>
    </tr>
    <tr>
      <td>Couenne</td>
      <td>MINLP</td>
      <td>与 Ipopt 结合使用，适合非线性整数问题</td>
      <td>EPL 开源</td>
    </tr>
    <tr>
      <td>HiGHS</td>
      <td>LP、MILP</td>
      <td>新兴开源求解器，速度快，逐渐被集成到主流工具链</td>
      <td>MIT 开源</td>
    </tr>
    <tr>
      <td>Baron</td>
      <td>NLP、MINLP</td>
      <td>全局优化器，支持非凸优化问题</td>
      <td>商业许可</td>
    </tr>
  </tbody>
</table>

<h2 id="7附录章节5中问题的数学表示">7、附录：章节5中问题的数学表示</h2>
<p>1. 决策变量</p>

<p>定义矩阵变量：</p>

\[x_{ij} \in [0,1], \quad i \in {0,1,2,3}, ; j \in {0,1,2,3}\]

<p>2. 参数（成本矩阵 $c_{ij}$）</p>

<p>代码里：</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>model.c = Param(model.I, model.J, initialize = {(1,1):2, (2,2):3}, default = 1)
</code></pre></div></div>
<p>意思是：
	•	默认 $c_{ij} = 1$，
	•	但 $c_{11} = 2$， $c_{22} = 3$。</p>

<p>所以：</p>

\[c = \begin{bmatrix}
1 &amp; 1 &amp; 1 &amp; 1 \\
1 &amp; 2 &amp; 1 &amp; 1 \\
1 &amp; 1 &amp; 3 &amp; 1 \\
1 &amp; 1 &amp; 1 &amp; 1
\end{bmatrix}\]

<p>3. 目标函数</p>

\[\min ; Z = \sum_{i=0}^3 \sum_{j=0}^3 c_{ij} x_{ij}\]

<p>4. 约束条件</p>

<p>(a) 每一行分配约束</p>

\[\sum_{j=0}^3 x_{ij} = 1, \quad \forall i=0,1,2,3\]

<p>(b) 每一列分配约束</p>

\[\sum_{i=0}^3 x_{ij} = 1, \quad \forall j=0,1,2,3\]

<p>5. 模型总结</p>

<p>整体优化问题是一个 指派问题 (Assignment Problem)：</p>

\[\begin{aligned}
\min_{x_{ij}} \quad &amp; \sum_{i=0}^3 \sum_{j=0}^3 c_{ij} x_{ij} \
\text{s.t.} \quad &amp; \sum_{j=0}^3 x_{ij} = 1, \quad \forall i=0,1,2,3 \
&amp; \sum_{i=0}^3 x_{ij} = 1, \quad \forall j=0,1,2,3 \
&amp; x_{ij} \in [0,1], \quad \forall i,j
\end{aligned}\]

<p>6. 解的含义</p>

<p>最优解矩阵：</p>

\[x^* =
\begin{bmatrix}
1 &amp; 0 &amp; 0 &amp; 0 \\
0 &amp; 0 &amp; 1 &amp; 0 \\
0 &amp; 0 &amp; 0 &amp; 1 \\
0 &amp; 1 &amp; 0 &amp; 0
\end{bmatrix}\]

<p>表示：
	•	第 0 个任务 → 第 0 个工人
	•	第 1 个任务 → 第 2 个工人
	•	第 2 个任务 → 第 3 个工人
	•	第 3 个任务 → 第 1 个工人</p>

<p>最优目标值：</p>

\[Z^* = 4\]


  </div>
</article>
    </div>
  </main>
  <footer>
    <div class="container">
      <p>&copy; 2025 Chocoleo.</p>
    </div>
  </footer>
</body>
</html>